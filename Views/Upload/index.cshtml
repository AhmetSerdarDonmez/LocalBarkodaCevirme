@{
    ViewBag.Title = "Upload Barcode Excel";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <h2>Upload Excel File</h2>
            <form id="uploadForm" action="@Url.Action("Index", "Upload")" method="post" enctype="multipart/form-data" class="form-inline">
                @Html.AntiForgeryToken()
                <div class="form-group mb-2">
                    <input type="file" name="file" class="form-control-file" required />
                </div>
                <button type="submit" class="btn btn-primary mb-2 ml-2">Upload</button>
            </form>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-12">
            <h2>Generate PDF from Text</h2>
            <form id="textForm" action="@Url.Action("GenerateFromText", "Upload")" method="post">
                @Html.AntiForgeryToken()
                <div class="form-group">
                    <textarea name="textData" rows="10" cols="50" class="form-control" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary mt-2">Generate PDF</button>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById('uploadForm').addEventListener('submit', function (event) {
            event.preventDefault();

            var formData = new FormData(this);
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '@Url.Action("Index", "Upload")', true);

            xhr.onload = function () {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    if (response.success) {
                        window.open(response.url, '_blank');
                    } else {
                        alert('Error uploading file.');
                    }
                } else {
                    alert('Error uploading file.');
                }
            };

            xhr.onerror = function () {
                alert('Error uploading file.');
            };

            xhr.send(formData);
        });

        document.getElementById('textForm').addEventListener('submit', function (event) {
            event.preventDefault();

            var formData = new FormData(this);
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '@Url.Action("GenerateFromText", "Upload")', true);

            xhr.onload = function () {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    if (response.success) {
                        window.open(response.url, '_blank');
                    } else {
                        alert('Error generating PDF.');
                    }
                } else {
                    alert('Error generating PDF.');
                }
            };

            xhr.onerror = function () {
                alert('Error generating PDF.');
            };

            xhr.send(formData);
        });
    });
</script>
