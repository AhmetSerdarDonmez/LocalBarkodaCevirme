@{
    ViewBag.Title = "Upload Barcode Excel";
}

<h2>Upload Excel File</h2>

<form id="uploadForm" action="@Url.Action("Index", "Upload")" method="post" enctype="multipart/form-data">
    @Html.AntiForgeryToken()
    <input type="file" name="file" required />
    <button type="submit">Upload</button>
</form>

<h2>Generate PDF from Text</h2>

<form id="textForm" action="@Url.Action("GenerateFromText", "Upload")" method="post">
    @Html.AntiForgeryToken()
    <textarea name="textData" rows="10" cols="50" required></textarea>
    <button type="submit">Generate PDF</button>
</form>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById('uploadForm').addEventListener('submit', function (event) {
            event.preventDefault();

            var formData = new FormData(this);
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '@Url.Action("Index", "Upload")', true);

            xhr.onload = function () {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    if (response.success) {
                        window.open(response.url, '_blank');
                    } else {
                        alert('Error uploading file.');
                    }
                } else {
                    alert('Error uploading file.');
                }
            };

            xhr.onerror = function () {
                alert('Error uploading file.');
            };

            xhr.send(formData);
        });

        document.getElementById('textForm').addEventListener('submit', function (event) {
            event.preventDefault();

            var formData = new FormData(this);
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '@Url.Action("GenerateFromText", "Upload")', true);

            xhr.onload = function () {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    if (response.success) {
                        window.open(response.url, '_blank');
                    } else {
                        alert('Error generating PDF.');
                    }
                } else {
                    alert('Error generating PDF.');
                }
            };

            xhr.onerror = function () {
                alert('Error generating PDF.');
            };

            xhr.send(formData);
        });
    });
</script>
